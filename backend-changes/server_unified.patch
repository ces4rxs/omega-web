# Backend Server Changes

## Instructions

Apply these changes to your `src/server_unified.ts` file.

---

## Change 1: Import AI Router

**Location:** After line 192 (after alerts router import)

**Add:**
```typescript
// ======================================================
// ðŸ§  AI/ML (Machine Learning Endpoints)
// ======================================================
import aiRouter from "./routes/ai.route.js";
app.use("/api/ai", aiRouter);
```

---

## Change 2: Update Home Page

**Location:** Replace the app.get("/", ...) function (around line 224)

**Replace:**
```typescript
app.get("/", (_req, res) => {
  res.send(`
    <h2>ðŸ§  OMEGA Unified Server v4.3.2</h2>
    <p>Servidor activo y funcionando correctamente ðŸš€</p>
    <ul>
      <li><a href="/health">/health</a> - Health check completo</li>
      <li><a href="/health/ready">/health/ready</a> - Readiness probe</li>
      <li><a href="/health/live">/health/live</a> - Liveness probe</li>
      <li><a href="/ai/status">/ai/status</a></li>
      <li><a href="/ai/manifest">/ai/manifest</a></li>
      <li><a href="/ai/ping">/ai/ping</a></li>
    </ul>
  `);
});
```

**With:**
```typescript
app.get("/", (_req, res) => {
  res.send(`
    <h2>ðŸ§  OMEGA Unified Server v4.3.2</h2>
    <p>Servidor activo y funcionando correctamente ðŸš€</p>
    <ul>
      <li><a href="/health">/health</a> - Health check completo</li>
      <li><a href="/health/ready">/health/ready</a> - Readiness probe</li>
      <li><a href="/health/live">/health/live</a> - Liveness probe</li>
      <li><a href="/ai/status">/ai/status</a></li>
      <li><a href="/ai/manifest">/ai/manifest</a></li>
      <li><a href="/ai/ping">/ai/ping</a></li>
      <li><a href="/api/ai/status">/api/ai/status</a> - ML System Status (NEW)</li>
    </ul>
    <h3>ðŸ§  ML Endpoints (Authenticated)</h3>
    <ul>
      <li>POST /api/ai/analyze - OMEGA Reflex Analysis</li>
      <li>POST /api/ai/insights - Explainable AI Insights</li>
      <li>POST /api/ai/quantum-risk - Risk Classification (K-Means)</li>
      <li>POST /api/ai/predict - ML Predictions (Enterprise)</li>
      <li>POST /api/ai/anomaly-check - Anomaly Detection</li>
      <li>POST /api/ai/optimize - Parameter Optimization</li>
    </ul>
  `);
});
```

---

## Summary of Changes

**Files to Add:**
1. `src/routes/ai.route.ts` (NEW - see ai.route.ts file)

**Files to Modify:**
2. `src/server_unified.ts` (2 changes - import router + update home page)

---

## Deployment Steps

### Option 1: Manual Copy

```bash
# 1. Copy the new route file
cp backend-changes/ai.route.ts src/routes/

# 2. Apply the patches to server_unified.ts manually
#    (See changes above)

# 3. Commit and push
git add src/routes/ai.route.ts src/server_unified.ts
git commit -m "feat: add ML API endpoints"
git push origin main
```

### Option 2: Git Apply (if you have the full patch)

```bash
git apply backend-changes/server_unified.patch
git add .
git commit -m "feat: add ML API endpoints"
git push origin main
```

---

## Verification

After deployment, verify the changes:

```bash
# Check ML system status
curl https://your-backend.onrender.com/api/ai/status

# Expected response:
# {
#   "ok": true,
#   "status": "ðŸ§  All ML systems operational"
# }
```

---

## Testing

```bash
# Test with authentication (replace YOUR_TOKEN)
curl -X POST https://your-backend.onrender.com/api/ai/insights \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "metrics": {
      "sharpe": 1.5,
      "mdd": -0.1,
      "cagr": 0.2,
      "tradesCount": 50,
      "winRate": 0.65,
      "profitFactor": 2.0,
      "avgWin": 100,
      "avgLoss": -50
    },
    "riskProfile": "moderate"
  }'
```

Expected response: Cognitive state with explanations and recommendations.
